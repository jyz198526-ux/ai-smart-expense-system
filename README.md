# 🤖 AI智能申请单系统

基于DeepSeek AI和易快报API的智能申请单创建系统

## ✨ 核心特性

### 🚀 智能化
- **AI自然语言理解**: 支持"创建"、"提交"、"写一个"等各种表达方式
- **动态字段识别**: 自动适配新增字段，无需硬编码
- **智能日期处理**: 理解"明天"、"下周一"、"1月15日"等多种日期表达

### 🔄 动态适配
- **实时模板拉取**: 每次强制获取最新模板，不使用缓存
- **字段类型识别**: 智能处理金额、日期、文本等不同类型字段
- **TOKEN自动刷新**: 启动时和关键操作前强制刷新认证

### 🎯 用户友好
- **自然交互**: "帮我写一个培训申请，费用5000元"
- **灵活表达**: 支持各种日期和金额表达方式
- **智能映射**: AI自动理解用户意图并映射到对应字段

## 🏗️ 系统架构

```
用户输入 → DeepSeek AI → MCP层 → 易快报API → 申请单创建
```

- **前端**: 简洁的Web聊天界面
- **AI层**: DeepSeek API进行自然语言理解和工具调用
- **MCP层**: 业务逻辑抽象层，处理字段映射和API调用
- **API层**: 易快报OpenAPI集成

## 📋 主要功能

### 1. 模板字段查询
```
用户: "查看申请表字段"
系统: 动态拉取并显示当前模板的所有字段信息
```

### 2. 智能申请单创建
```
用户: "申请培训费用5000元，明天开始"
系统: 自动创建包含标题、金额、日期等信息的申请单
```

### 3. 单据状态查询
```
用户: "查询单据 S25000129"
系统: 返回指定编号的申请单详情
```

## 🛠️ 技术栈

- **后端**: FastAPI + Python 3.8+
- **AI**: DeepSeek Chat API
- **第三方API**: 易快报 OpenAPI
- **前端**: HTML + JavaScript + CSS

## 📁 项目结构

```
D:\AI开发\助手4\
├── main.py                 # FastAPI主服务
├── smart_expense_mcp.py     # MCP业务逻辑层
├── config.py               # 配置管理
├── services/               # 服务层
│   ├── auth_service.py     # 认证服务
│   └── deepseek_service.py # AI服务
├── templates/              # 前端模板
│   └── index.html         # 聊天界面
└── requirements.txt        # 依赖包

```

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 配置环境变量
创建 `.env` 文件：
```env
DEEPSEEK_API_KEY=your_deepseek_api_key
EK_APP_KEY=your_ekuaibao_app_key
EK_APP_SECURITY=your_ekuaibao_app_security
```

### 3. 启动服务
```bash
python main.py
```

### 4. 访问系统
打开浏览器访问: `http://localhost:8000`

## 🔧 核心设计理念

### 完全动态化
- ❌ 不使用硬编码字段定义
- ✅ 动态解析API返回的字段配置
- ✅ 自动适配新增字段类型

### 充分利用AI
- ❌ 不自己处理同义词映射
- ✅ 让AI理解用户的真实意图
- ✅ 支持自然语言的灵活表达

### 实时数据保证
- ❌ 不使用任何缓存机制
- ✅ 每次都拉取最新模板数据
- ✅ 强制TOKEN刷新确保有效性

## 📝 更新日志

### v1.0.0 (2025-01-09)
- ✅ 实现AI智能申请单创建
- ✅ 动态字段识别和处理
- ✅ 智能日期格式处理
- ✅ 自然语言理解优化
- ✅ 完全移除硬编码依赖

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License