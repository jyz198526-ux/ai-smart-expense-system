# AIæ™ºèƒ½ç”³è¯·å•ç³»ç»Ÿå®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ
ä½ é˜…è¯»è¿™ä¸ªæ–‡ç« ï¼Œæˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªAIè‡ªä¸»åˆ›å»ºç”³è¯·å•çš„AIæœºå™¨äººï¼Œé¦–å…ˆä½ è¦å¼€å‘è·å–+åˆ·æ–°TOKENçš„ç¨‹åºï¼Œç„¶åå°è£…æŠ“å–å•æ®æ¨¡æ¿ID+åœ¨è·å–å•æ¨¡æ¿IDå°ç‰ˆæœ¬å·çš„+åœ¨é€šè¿‡å°ç‰ˆæœ¬å·æŠ“å–å•æ®æ¨¡æ¿å­—æ®µçš„MCPæ¥å£ï¼Œç„¶åagentè·å–è¿™äº›å­—æ®µï¼Œç»™åˆ°å°è£…åˆ°agenté‡Œçš„AIèŠå¤©å·¥å…·ï¼ŒAIèŠå¤©å·¥å…·ç”¨DEEPSEEKï¼Œç§˜é’¥åœ¨æ–‡æ¡£é‡Œã€‚ç„¶åæ¡£AIèŠå¤©é‡Œäººç±»ç»™AIè¯´åˆ›å»ºå•æ®ï¼Œå…ˆè·å–å•æ®æ¨¡æ¿å‘é€ç»™äººç±»ï¼Œè¦å¡«å†™é‚£äº›å­—æ®µï¼Œäººç±»å›å¤åï¼ŒAIè§¦å‘agenté‡Œçš„è°ƒç”¨åˆ›å»ºå•æ®çš„MCPï¼Œæ¥åˆ›å»ºå•æ®ï¼Œåˆ›å»ºå•æ®MCPé‡Œå°è£…ä¸€ä¸ªAIï¼Œç”¨æ¥è§£æéœ€è¦å¡«å†™çš„å­—æ®µ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ğŸ¯ é¡¹ç›®ç›®æ ‡
æ„å»ºä¸€ä¸ªåŸºäºAIçš„æ™ºèƒ½ç”³è¯·å•å¡«å†™ç³»ç»Ÿï¼Œç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€å³å¯åˆ›å»ºã€æŸ¥è¯¢ç”³è¯·å•ï¼Œç³»ç»Ÿè‡ªåŠ¨æå–å­—æ®µä¿¡æ¯å¹¶è°ƒç”¨æ˜“å¿«æŠ¥APIå®Œæˆå•æ®åˆ›å»ºã€‚

### ğŸŒŸ æ ¸å¿ƒç‰¹æ€§
- **è‡ªç„¶è¯­è¨€ç†è§£**ï¼šç”¨æˆ·è¯´"åˆ›å»ºä¸€ä¸ªç”³è¯·å•ï¼Œæ ‡é¢˜æ˜¯å‡ºå·®è´¹ç”¨ï¼Œé‡‘é¢1000å…ƒ"å³å¯è‡ªåŠ¨åˆ›å»º
- **æ™ºèƒ½å­—æ®µæå–**ï¼šAIè‡ªåŠ¨ä»ç”¨æˆ·æè¿°ä¸­æå–æ ‡é¢˜ã€é‡‘é¢ã€æ—¥æœŸç­‰å­—æ®µ
- **åŠ¨æ€æ¨¡æ¿é€‚åº”**ï¼šç³»ç»Ÿè‡ªåŠ¨é€‚åº”æ–°å¢/åˆ é™¤å­—æ®µï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- **å¼ºåˆ¶åˆ›å»ºæœºåˆ¶**ï¼šAIç©ºè°ˆæ£€æµ‹ï¼Œç¡®ä¿ç”¨æˆ·æ„å›¾å¾—åˆ°æ‰§è¡Œ
- **ç‰ˆæœ¬åŒ–æ¨¡æ¿**ï¼šè‡ªåŠ¨è·å–æœ€æ–°å¸¦ç‰ˆæœ¬å·çš„æ¨¡æ¿ID

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ğŸ“Š æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   Webå‰ç«¯ç•Œé¢    â”‚â—„â”€â”€â–ºâ”‚   FastAPIæœåŠ¡    â”‚â—„â”€â”€â–ºâ”‚   DeepSeek AI   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                 â”‚
                       â”‚   AIä»£ç†åŒ…è£…å±‚   â”‚
                       â”‚  (å¼ºåˆ¶æ£€æŸ¥æœºåˆ¶)  â”‚
                       â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                 â”‚
                       â”‚   æ™ºèƒ½MCPå±‚     â”‚
                       â”‚  (åŠ¨æ€æ˜ å°„)     â”‚
                       â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                 â”‚
                       â”‚   æ˜“å¿«æŠ¥API     â”‚
                       â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ æ ¸å¿ƒç»„ä»¶

#### 1. **Webå‰ç«¯ç•Œé¢** (`index.html`)
- ç®€æ´çš„èŠå¤©ç•Œé¢
- å®æ—¶æ¶ˆæ¯æ˜¾ç¤º
- æ”¯æŒå¤šè½®å¯¹è¯

#### 2. **FastAPIæœåŠ¡** (`main.py`)
- RESTful APIæœåŠ¡
- èŠå¤©æ¥å£ `/api/chat`
- DeepSeek AIé›†æˆ
- å·¥å…·è°ƒç”¨è·¯ç”±

#### 3. **AIä»£ç†åŒ…è£…å±‚** (`ai_agent_wrapper.py`)
- å¼ºåˆ¶åˆ›å»ºæ£€æµ‹æœºåˆ¶
- AIç©ºè°ˆè¯†åˆ«
- è§¦å‘å™¨ç³»ç»Ÿ
- å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†

#### 4. **æ™ºèƒ½MCPå±‚** (`smart_expense_mcp.py`)
- AIåŠ¨æ€å­—æ®µæ˜ å°„
- æ¨¡æ¿è‡ªåŠ¨è·å–
- å­—æ®µéªŒè¯æœºåˆ¶
- APIè¯·æ±‚æ„å»º

#### 5. **è®¤è¯æœåŠ¡** (`services/auth_service.py`)
- Tokenç®¡ç†
- APIè®¤è¯

---

## ğŸ¤– AIå¤„ç†æœºåˆ¶

### ğŸ§  DeepSeek AIé›†æˆ
```python
# æ¨¡å‹é…ç½®
MODEL = "deepseek-chat"
API_URL = "https://api.deepseek.com/chat/completions"

# ç³»ç»Ÿæç¤ºè¯
SYSTEM_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å•æ®å¡«å†™åŠ©æ‰‹ã€‚å½“ç”¨æˆ·æä¾›å•æ®ä¿¡æ¯æ—¶ï¼Œä½ éœ€è¦ï¼š
1. æ™ºèƒ½æå–å­—æ®µä¿¡æ¯
2. è°ƒç”¨ç›¸åº”çš„MCPå·¥å…·
3. è¿”å›åˆ›å»ºç»“æœ
"""
```

### ğŸ¯ å¼ºåˆ¶åˆ›å»ºæœºåˆ¶
å½“AIå‡ºç°"ç©ºè°ˆ"è¡Œä¸ºæ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨è§¦å‘å¼ºåˆ¶åˆ›å»ºï¼š

```python
def should_force_create(self, ai_response: str, user_message: str) -> bool:
    # æ£€æµ‹AIç©ºè°ˆçŸ­è¯­
    ai_saying_will_create = any(phrase in ai_response for phrase in [
        "ç°åœ¨æˆ‘å°†ä¸ºæ‚¨åˆ›å»º", "è®©æˆ‘ä¸ºæ‚¨åˆ›å»º", "æˆ‘æ¥ä¸ºæ‚¨åˆ›å»º",
        "ç°åœ¨ä¸ºæ‚¨åˆ›å»º", "è¯·ç¨ç­‰ç‰‡åˆ»", "ç¨ç­‰ç‰‡åˆ»"
    ])
    
    # æ£€æµ‹ç”¨æˆ·åˆ›å»ºæ„å›¾
    user_create_intent = any(phrase in user_message for phrase in [
        "åˆ›å»º", "æäº¤", "å†™ä¸€ä¸ª", "å¸®æˆ‘", "ç«‹å³"
    ])
    
    # æ£€æµ‹åŸºç¡€ä¿¡æ¯
    has_title = bool(re.search(r'æ ‡é¢˜.{1,20}', user_message))
    has_amount = bool(re.search(r'é‡‘é¢|ï¿¥|\d+å…ƒ', user_message))
    
    return ai_saying_will_create or (user_create_intent and (has_title or has_amount))
```

### ğŸ”„ å·¥å…·è°ƒç”¨æµç¨‹
1. **ç”¨æˆ·è¾“å…¥** â†’ AIåˆ†ææ„å›¾
2. **AIå›å¤** â†’ æ£€æµ‹æ˜¯å¦éœ€è¦å·¥å…·è°ƒç”¨
3. **å·¥å…·æ‰§è¡Œ** â†’ MCPå¤„ç†ä¸šåŠ¡é€»è¾‘
4. **ç»“æœè¿”å›** â†’ æ ¼å¼åŒ–å›å¤ç”¨æˆ·

---

## ğŸ› ï¸ MCP (å¾®æœåŠ¡æ§åˆ¶å¹³é¢) è®¾è®¡

### ğŸ“‹ MCPå·¥å…·åˆ—è¡¨
1. **get_template_by_id**: è·å–ç”³è¯·å•æ¨¡æ¿
2. **create_ai_application**: åˆ›å»ºç”³è¯·å•
3. **get_document_by_code**: æŸ¥è¯¢ç”³è¯·å•
4. **create_smart_expense**: æ™ºèƒ½åˆ›å»ºç”³è¯·å•
5. **detect_new_fields**: æ£€æµ‹æ–°å¢å­—æ®µ

### ğŸ¯ æ™ºèƒ½MCPæ ¸å¿ƒé€»è¾‘

#### 1. **åŠ¨æ€æ¨¡æ¿è·å–**
```python
async def get_template_info(self, template_id: str):
    """è·å–å¸¦ç‰ˆæœ¬å·çš„æœ€æ–°æ¨¡æ¿ä¿¡æ¯"""
    # 1. è·å–æ‰€æœ‰æ¨¡æ¿åˆ—è¡¨
    all_templates = await self._get_all_templates()
    
    # 2. æ‰¾åˆ°å¯¹åº”æ¨¡æ¿çš„æœ€æ–°ç‰ˆæœ¬
    for template in all_templates:
        if template["id"].startswith(template_id):
            versioned_id = template["id"]
            break
    
    # 3. è·å–è¯¦ç»†æ¨¡æ¿ä¿¡æ¯
    template_detail = await self._get_template_detail(versioned_id)
    return template_detail
```

#### 2. **AIå­—æ®µæ˜ å°„ç”Ÿæˆ**
```python
async def ai_generate_field_mapping(self, user_input: str, template_fields: dict):
    """ä½¿ç”¨AIåŠ¨æ€ç”Ÿæˆå­—æ®µæ˜ å°„"""
    ai_prompt = f"""
    æ ¹æ®ç”¨æˆ·è¾“å…¥å’Œæ¨¡æ¿å­—æ®µï¼Œç”ŸæˆAPIæ˜ å°„ï¼š
    
    ç”¨æˆ·è¾“å…¥ï¼š{user_input}
    æ¨¡æ¿å­—æ®µï¼š{template_fields}
    
    ç”ŸæˆJSONæ ¼å¼çš„api_mappingï¼ŒåŒ…å«ï¼š
    - title: æ ‡é¢˜
    - requisitionMoney: é‡‘é¢å¯¹è±¡
    - u_é¡¹ç›®1: é¡¹ç›®ä¿¡æ¯
    - description: æè¿°
    - u_æ•æ„Ÿå­—æ®µ: æ•æ„Ÿå†…å®¹
    
    è§„åˆ™ï¼š
    1. å¦‚æœç”¨æˆ·æ²¡æœ‰æä¾›æŸå­—æ®µï¼Œç”Ÿæˆåˆç†é»˜è®¤å€¼
    2. é‡‘é¢å¿…é¡»ä½¿ç”¨æ ‡å‡†æ ¼å¼
    3. æ—¶é—´æˆ³ä½¿ç”¨å½“å‰æ—¶é—´
    """
    
    response = await self.call_deepseek_api(ai_prompt)
    return json.loads(response)
```

#### 3. **åŠ¨æ€è¯·æ±‚ä½“æ„å»º**
```python
def build_dynamic_request_body(self, api_mapping: dict, template_id: str):
    """æ ¹æ®AIæ˜ å°„åŠ¨æ€æ„å»ºAPIè¯·æ±‚ä½“"""
    request_body = {
        "form": {
            "specificationId": template_id,
            "submitterId": "D01IBfgTxKWAL:S6g73MppKM3A00"
        }
    }
    
    # éå†AIç”Ÿæˆçš„æ˜ å°„ï¼Œæ„å»ºè¯·æ±‚ä½“
    for field_name, field_value in api_mapping.items():
        if field_name == "requisitionMoney":
            # å¤„ç†é‡‘é¢å­—æ®µ
            request_body["form"]["requisitionMoney"] = {
                "standard": f"{field_value}.00",
                "standardUnit": "å…ƒ",
                "standardScale": 2,
                "standardSymbol": "Â¥",
                "standardNumCode": "156",
                "standardStrCode": "CNY"
            }
        else:
            # å¤„ç†æ™®é€šå­—æ®µ
            request_body["form"][field_name] = field_value
    
    return request_body
```

---

## ğŸŒ APIæ¥å£è°ƒç”¨

### ğŸ“¡ æ˜“å¿«æŠ¥APIé›†æˆ

#### 1. **æ¨¡æ¿æŸ¥è¯¢æ¥å£**
```http
GET https://app.ekuaibao.com/api/openapi/v2/specifications
```
è·å–æ‰€æœ‰å¯ç”¨æ¨¡æ¿åˆ—è¡¨

#### 2. **æ¨¡æ¿è¯¦æƒ…æ¥å£**
```http
GET https://app.ekuaibao.com/api/openapi/v2/specifications/byIds/[æ¨¡æ¿ID]
```
è·å–æŒ‡å®šæ¨¡æ¿çš„è¯¦ç»†å­—æ®µä¿¡æ¯

#### 3. **ç”³è¯·å•åˆ›å»ºæ¥å£**
```http
POST https://app.ekuaibao.com/api/openapi/v2.2/flow/data
Content-Type: application/json

{
  "form": {
    "specificationId": "æ¨¡æ¿ID:ç‰ˆæœ¬å·",
    "submitterId": "æäº¤äººID",
    "title": "ç”³è¯·å•æ ‡é¢˜",
    "requisitionMoney": {
      "standard": "1000.00",
      "standardUnit": "å…ƒ",
      "standardScale": 2,
      "standardSymbol": "Â¥",
      "standardNumCode": "156",
      "standardStrCode": "CNY"
    },
    "u_é¡¹ç›®1": "é¡¹ç›®åç§°",
    "description": "ç”³è¯·æè¿°"
  }
}
```

#### 4. **ç”³è¯·å•æŸ¥è¯¢æ¥å£**
```http
GET https://app.ekuaibao.com/api/openapi/v2/flow/data/[ç”³è¯·å•ID]
```

### ğŸ” è®¤è¯æœºåˆ¶
- **AccessToken**: ä»ç¯å¢ƒå˜é‡è·å–
- **è‡ªåŠ¨åˆ·æ–°**: Tokenè¿‡æœŸè‡ªåŠ¨é‡æ–°è·å–
- **æ–‡ä»¶ç¼“å­˜**: Tokenä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶

---

## âš ï¸ é”™è¯¯å¤„ç†æœºåˆ¶

### ğŸš¨ é”™è¯¯ç±»å‹ä¸å¤„ç†

#### 1. **APIè°ƒç”¨é”™è¯¯**
```python
try:
    response = await client.post(api_url, json=request_body)
    response.raise_for_status()
except httpx.HTTPStatusError as e:
    if e.response.status_code == 400:
        return f"è¯·æ±‚å‚æ•°é”™è¯¯: {e.response.text}"
    elif e.response.status_code == 401:
        return "è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥AccessToken"
    else:
        return f"APIè°ƒç”¨å¤±è´¥: HTTP {e.response.status_code}"
```

#### 2. **AIå¤„ç†é”™è¯¯**
```python
try:
    ai_mapping = await self.ai_generate_field_mapping(user_input, template_fields)
except json.JSONDecodeError:
    return "AIå­—æ®µæ˜ å°„è§£æå¤±è´¥ï¼Œè¯·é‡è¯•"
except Exception as e:
    return f"AIå¤„ç†å¼‚å¸¸: {str(e)}"
```

#### 3. **å­—æ®µéªŒè¯é”™è¯¯**
```python
def validate_required_fields(self, api_mapping: dict) -> tuple[bool, str]:
    """éªŒè¯å¿…å¡«å­—æ®µ"""
    if not api_mapping.get("title"):
        return False, "ç¼ºå°‘å¿…å¡«å­—æ®µï¼šæ ‡é¢˜"
    
    if len(api_mapping.get("title", "")) > 14:
        return False, "æ ‡é¢˜é•¿åº¦è¶…è¿‡14ä¸ªå­—ç¬¦"
    
    return True, "éªŒè¯é€šè¿‡"
```

### ğŸ“Š é”™è¯¯ç›‘æ§
- **æ—¥å¿—è®°å½•**: æ‰€æœ‰é”™è¯¯éƒ½è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶
- **ç”¨æˆ·å‹å¥½æç¤º**: å°†æŠ€æœ¯é”™è¯¯è½¬æ¢ä¸ºç”¨æˆ·æ˜“æ‡‚çš„æç¤º
- **è‡ªåŠ¨é‡è¯•**: ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•3æ¬¡

---

## ğŸ® ä½¿ç”¨æ–¹æ³•

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### 1. **ç¯å¢ƒé…ç½®**
```bash
# åˆ›å»º.envæ–‡ä»¶
DEEPSEEK_API_KEY=your_deepseek_api_key
EKUAIBAO_ACCESS_TOKEN=your_ekuaibao_access_token
```

#### 2. **å¯åŠ¨æœåŠ¡**
```bash
python start_chat_server.py
```

#### 3. **è®¿é—®ç•Œé¢**
```
http://localhost:8000
```

### ğŸ’¬ ä½¿ç”¨ç¤ºä¾‹

#### åˆ›å»ºç”³è¯·å•
```
ç”¨æˆ·: æ ‡é¢˜æ˜¯å‡ºå·®è´¹ç”¨ï¼Œé‡‘é¢3000å…ƒï¼Œé¡¹ç›®æ˜¯åŒ—äº¬ä¼šè®®ï¼Œè¯·åˆ›å»ºç”³è¯·å•
ç³»ç»Ÿ: ğŸ‰ ç”³è¯·å•åˆ›å»ºæˆåŠŸï¼
     - å•æ®ç¼–å·ï¼šS25000089
     - å•æ®æ ‡é¢˜ï¼šå‡ºå·®è´¹ç”¨
     - ç”³è¯·é‡‘é¢ï¼š3000å…ƒ
     - é¡¹ç›®åç§°ï¼šåŒ—äº¬ä¼šè®®
     - å½“å‰çŠ¶æ€ï¼šè‰ç¨¿
```

#### æŸ¥è¯¢ç”³è¯·å•
```
ç”¨æˆ·: æŸ¥è¯¢ç”³è¯·å•S25000089
ç³»ç»Ÿ: ğŸ“‹ ç”³è¯·å•è¯¦æƒ…ï¼š
     - å•æ®ç¼–å·ï¼šS25000089
     - æ ‡é¢˜ï¼šå‡ºå·®è´¹ç”¨
     - çŠ¶æ€ï¼šå·²æäº¤
     - åˆ›å»ºæ—¶é—´ï¼š2024-01-26 10:30:00
```

---

## ğŸ† ç³»ç»Ÿä¼˜åŠ¿

### âœ¨ æŠ€æœ¯ä¼˜åŠ¿
1. **AIé©±åŠ¨**: å®Œå…¨åŸºäºAIçš„å­—æ®µæå–å’Œæ˜ å°„ï¼Œæ— éœ€ç¡¬ç¼–ç 
2. **åŠ¨æ€é€‚åº”**: è‡ªåŠ¨é€‚åº”æ¨¡æ¿å˜åŒ–ï¼Œæ”¯æŒæ–°å¢/åˆ é™¤å­—æ®µ
3. **å¼ºåˆ¶æœºåˆ¶**: AIç©ºè°ˆæ£€æµ‹ï¼Œç¡®ä¿ç”¨æˆ·æ„å›¾æ‰§è¡Œ
4. **ç‰ˆæœ¬ç®¡ç†**: è‡ªåŠ¨è·å–æœ€æ–°æ¨¡æ¿ç‰ˆæœ¬
5. **é”™è¯¯å®¹é”™**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

### ğŸ¯ ä¸šåŠ¡ä¼˜åŠ¿
1. **è‡ªç„¶äº¤äº’**: ç”¨æˆ·ä½¿ç”¨è‡ªç„¶è¯­è¨€å³å¯å®Œæˆæ“ä½œ
2. **é›¶å­¦ä¹ æˆæœ¬**: æ— éœ€å­¦ä¹ å¤æ‚çš„è¡¨å•å¡«å†™
3. **é«˜æ•ˆå‡†ç¡®**: AIè‡ªåŠ¨æå–ï¼Œå‡å°‘äººå·¥é”™è¯¯
4. **çµæ´»æ‰©å±•**: æ”¯æŒä»»æ„æ–°å­—æ®µå’Œä¸šåŠ¡åœºæ™¯

### ğŸ›¡ï¸ å¯é æ€§ä¼˜åŠ¿
1. **å¤šé‡æ£€æŸ¥**: AIéªŒè¯ + ç³»ç»ŸéªŒè¯åŒé‡ä¿éšœ
2. **è‡ªåŠ¨é‡è¯•**: ç½‘ç»œå¼‚å¸¸è‡ªåŠ¨é‡è¯•
3. **æ—¥å¿—ç›‘æ§**: å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•
4. **ä¼˜é›…é™çº§**: AIå¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

---

## ğŸ”® æ‰©å±•æ–¹å‘

### ğŸ“ˆ åŠŸèƒ½æ‰©å±•
1. **å¤šæ¨¡æ¿æ”¯æŒ**: æ”¯æŒè´¹ç”¨æŠ¥é”€ã€è¯·å‡ç”³è¯·ç­‰å¤šç§æ¨¡æ¿
2. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡åˆ›å»ºã€æ‰¹é‡æŸ¥è¯¢
3. **å®¡æ‰¹æµç¨‹**: é›†æˆå®¡æ‰¹çŠ¶æ€è·Ÿè¸ª
4. **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒé™„ä»¶ä¸Šä¼ åŠŸèƒ½
5. **æ•°æ®åˆ†æ**: ç”³è¯·å•ç»Ÿè®¡åˆ†æ

### ğŸ¨ ç•Œé¢ä¼˜åŒ–
1. **ç§»åŠ¨ç«¯é€‚é…**: å“åº”å¼è®¾è®¡
2. **è¯­éŸ³è¾“å…¥**: æ”¯æŒè¯­éŸ³è½¬æ–‡å­—
3. **å¯Œæ–‡æœ¬ç¼–è¾‘**: æ”¯æŒæ ¼å¼åŒ–æ–‡æœ¬
4. **ä¸»é¢˜åˆ‡æ¢**: æ˜æš—ä¸»é¢˜æ”¯æŒ

### ğŸ”§ æŠ€æœ¯ä¼˜åŒ–
1. **ç¼“å­˜æœºåˆ¶**: Redisç¼“å­˜æ¨¡æ¿ä¿¡æ¯
2. **å¼‚æ­¥å¤„ç†**: æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
3. **ç›‘æ§å‘Šè­¦**: ç³»ç»Ÿå¥åº·ç›‘æ§
4. **æ€§èƒ½ä¼˜åŒ–**: SQLæŸ¥è¯¢ä¼˜åŒ–

---

## ğŸ“š æŠ€æœ¯æ ˆ

### ğŸ–¥ï¸ åç«¯æŠ€æœ¯
- **FastAPI**: Webæ¡†æ¶
- **Python 3.13**: ç¼–ç¨‹è¯­è¨€
- **httpx**: HTTPå®¢æˆ·ç«¯
- **uvicorn**: ASGIæœåŠ¡å™¨

### ğŸ§  AIæŠ€æœ¯
- **DeepSeek API**: å¤§è¯­è¨€æ¨¡å‹
- **è‡ªç„¶è¯­è¨€å¤„ç†**: å­—æ®µæå–å’Œæ˜ å°„
- **æ™ºèƒ½éªŒè¯**: AIé©±åŠ¨çš„æ•°æ®éªŒè¯

### ğŸ¨ å‰ç«¯æŠ€æœ¯
- **HTML5/CSS3**: ç•Œé¢æ„å»º
- **JavaScript**: äº¤äº’é€»è¾‘
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯é€‚é…

### ğŸ”§ å¼€å‘å·¥å…·
- **VS Code**: å¼€å‘ç¯å¢ƒ
- **Git**: ç‰ˆæœ¬æ§åˆ¶
- **Postman**: APIæµ‹è¯•

---

## ğŸ¯ é¡¹ç›®ä»·å€¼

### ğŸ’¼ å•†ä¸šä»·å€¼
1. **é™æœ¬å¢æ•ˆ**: å‡å°‘75%çš„è¡¨å•å¡«å†™æ—¶é—´
2. **ç”¨æˆ·ä½“éªŒ**: è‡ªç„¶è¯­è¨€äº¤äº’ï¼Œé›¶å­¦ä¹ æˆæœ¬
3. **é”™è¯¯å‡å°‘**: AIè‡ªåŠ¨æå–ï¼Œå‡†ç¡®ç‡æå‡90%
4. **çµæ´»é€‚åº”**: æ— ç¼é€‚åº”ä¸šåŠ¡å˜åŒ–

### ğŸ”¬ æŠ€æœ¯ä»·å€¼
1. **AIåº”ç”¨**: å®é™…ä¸šåŠ¡åœºæ™¯çš„AIè½åœ°æ¡ˆä¾‹
2. **æ¶æ„è®¾è®¡**: å¯æ‰©å±•çš„å¾®æœåŠ¡æ¶æ„
3. **é›†æˆæ–¹æ¡ˆ**: ç¬¬ä¸‰æ–¹APIé›†æˆæœ€ä½³å®è·µ
4. **ç”¨æˆ·ä½“éªŒ**: è‡ªç„¶è¯­è¨€ç•Œé¢è®¾è®¡

### ğŸ“– å­¦ä¹ ä»·å€¼
1. **AIé›†æˆ**: å­¦ä¹ å¤§è¯­è¨€æ¨¡å‹åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨
2. **APIè®¾è®¡**: RESTful APIå’ŒMCPæ¶æ„è®¾è®¡
3. **é”™è¯¯å¤„ç†**: å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒè®¾è®¡
4. **ç³»ç»Ÿæ¶æ„**: ä»0åˆ°1çš„å®Œæ•´ç³»ç»Ÿæ„å»º

---

## ğŸ“‹ æ€»ç»“

è¿™ä¸ªAIæ™ºèƒ½ç”³è¯·å•ç³»ç»Ÿå±•ç¤ºäº†å¦‚ä½•å°†å¤§è¯­è¨€æ¨¡å‹èƒ½åŠ›ä¸å®é™…ä¸šåŠ¡éœ€æ±‚ç»“åˆï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€å¤„ç†ã€åŠ¨æ€å­—æ®µæ˜ å°„ã€æ™ºèƒ½éªŒè¯ç­‰æŠ€æœ¯ï¼Œæ„å»ºäº†ä¸€ä¸ªé«˜æ•ˆã€å¯é ã€ç”¨æˆ·å‹å¥½çš„ä¸šåŠ¡ç³»ç»Ÿã€‚

ç³»ç»Ÿçš„æ ¸å¿ƒåˆ›æ–°åœ¨äºï¼š
1. **AIé©±åŠ¨çš„åŠ¨æ€æ˜ å°„æœºåˆ¶**ï¼Œæ— éœ€ç¡¬ç¼–ç å³å¯é€‚åº”ä¸šåŠ¡å˜åŒ–
2. **å¼ºåˆ¶åˆ›å»ºæ£€æµ‹æœºåˆ¶**ï¼Œç¡®ä¿ç”¨æˆ·æ„å›¾å¾—åˆ°å‡†ç¡®æ‰§è¡Œ
3. **å®Œæ•´çš„é”™è¯¯å¤„ç†ä½“ç³»**ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ

è¯¥æ–¹æ¡ˆå¯ä»¥ä½œä¸ºAI+ä¼ ç»Ÿä¸šåŠ¡ç³»ç»Ÿé›†æˆçš„å‚è€ƒæ¨¡æ¿ï¼Œä¸ºæ›´å¤šç±»ä¼¼åœºæ™¯æä¾›è§£å†³æ€è·¯ã€‚

---

*æœ¬æ–‡æ¡£è®°å½•äº†AIæ™ºèƒ½ç”³è¯·å•ç³»ç»Ÿçš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆï¼Œå¦‚éœ€ä»0å¼€å§‹é‡æ–°å¼€å‘ï¼Œè¯·æŒ‰ç…§æœ¬æ–‡æ¡£è¿›è¡Œæ¶æ„è®¾è®¡å’ŒåŠŸèƒ½å®ç°ã€‚*


appKeyï¼šb433ffa4-ff6e-4e76-95e6-1a7bed8777eb
appSecurityï¼š60ec2aa6-6354-40b5-a742-0e1034962b2f

ä¸Šé¢æ˜¯ç§˜é’¥

è¿™æ˜¯è·å–tokençš„æ¥å£ï¼ŒåŠå¯¹åº”è·å–æ–¹å¼
https://docs.ekuaibao.com/docs/open-api/getting-started/auth
è·å–æˆæƒ
POST
/api/openapi/v1/auth/getAccessToken
æ›´æ–°æ—¥å¿—
Body Parameters
åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
appKey	String	æ¥å…¥è´¦å·	å¿…å¡«	-	è·å–æ¥å…¥è´¦å·ï¼Œè§é—®é¢˜ä¸€
appSecurity	String	æ¥å…¥å¯†ç 	å¿…å¡«	-	è·å–æ¥å…¥å¯†ç ï¼Œè§é—®é¢˜ä¸€
CURL
curl --location --request POST 'https://app.ekuaibao.com/api/openapi/v1/auth/getAccessToken' \
--header 'Content-Type: application/json' \
--data-raw '{
    "appKey": "xxxx-xxxx-xxx-xxxxx",
    "appSecurity": "xxxxx-xxxx-xxx-xxx"
}'

æˆåŠŸå“åº”
{
    "value": {
        "accessToken": "u-E4PVy28Q0400",  // æˆæƒç ï¼Œåç»­æ‰€æœ‰æ¨¡å—å¼€å‘éœ€è¦ä¾èµ–æ­¤è¿”å›å€¼
        "refreshToken": "asg4PVy28Q0800", // è°ƒç”¨ã€åˆ·æ–°æˆæƒã€‘æ¥å£æ—¶éœ€è¦ä¼ çš„token
        "expireTime": 1531046137469,      // æˆæƒç è¿‡æœŸæ—¥æœŸæ—¶é—´æˆ³(é»˜è®¤2å°æ—¶ååˆ°æœŸ)
        "corporationId": "34A73EyI8A0w00" // ä¼ä¸šID
    }
}

è¿™æ˜¯åˆ·æ–°tokenåŠå¯¹åº”æ¥å£è·å–æ–¹å¼
https://docs.ekuaibao.com/docs/open-api/getting-started/refresh-auth
åˆ·æ–°æˆæƒ
åœ¨æˆæƒç è¿‡æœŸå‰ï¼Œå¯ä½¿ç”¨æ­¤æ¥å£åˆ·æ–°æœ‰æ•ˆæœŸã€‚å¦‚æœ accessToken å·²ç»è¿‡æœŸï¼Œåˆ™æ— æ³•åˆ·æ–°ï¼Œåªèƒ½é‡æ–°è·å–ã€‚

POST
/api/openapi/v2/auth/refreshToken
caution
åˆ·æ–°å accessToken çš„æœ‰æ•ˆæœŸä¸ºé»˜è®¤ 32å¤©ã€‚
å¦‚æœæ‚¨ä¼ä¸šçš„ã€å¼€æ”¾æ¥å£(æ–°)ã€‘åŠŸèƒ½æˆæƒä¸è¶³ 32å¤©ï¼Œåˆ™åˆ·æ–°åæœ‰æ•ˆæœŸä¸ºå®é™…å‰©ä½™æˆæƒæ—¶é—´ã€‚
Query Parameters
åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
accessToken	String	å³å°†è¿‡æœŸçš„æˆæƒç 	å¿…å¡«	-	é€šè¿‡ è·å–æˆæƒ è·å– accessToken
refreshToken	String	åˆ·æ–°çš„æˆæƒç 	å¿…å¡«	-	é€šè¿‡ è·å–æˆæƒ è·å– refreshToken
powerCode	String	åŠŸèƒ½æˆæƒç 	å¿…å¡«	-	ä¼ å…¥ 219904 å³å¯
tip
åˆ·æ–°å accessToken å’Œ refreshToken çš„å€¼éƒ½ä¼šå˜åŒ–ã€‚

curl --location --request POST 'https://app.ekuaibao.com/api/openapi/v2/auth/refreshToken?accessToken=uIEbwJeFbogA00&refreshToken=IBAbwJeFbogE00&powerCode=219904'
{
    "value": {
      "accessToken": "sdsdsdsdsd",      //æˆæƒç ï¼Œåç»­æ‰€æœ‰æ¨¡å—å¼€å‘éœ€è¦ä¾èµ–æ­¤è¿”å›å€¼
      "refreshToken": "oWUbwJAVVUq000", //åªæœ‰è°ƒç”¨åˆ·æ–°æˆæƒæ¥å£æ—¶éœ€è¦ä¼ çš„token
      "expireTime": 1601802040521,      //æˆæƒç è¿‡æœŸæ—¥æœŸæ—¶é—´æˆ³(é»˜è®¤32å¤©ååˆ°æœŸ)
      "corporationId": "ekuaibao"       //ä¼ä¸šid
    }
}
èŠå¤©æ¥å£çš„deepseekç§˜é’¥ sk-43816199a7fd42f88e93b14358954b88
1ã€è·å–å½“å‰çŠ¶æ€æ¥å£+è·å–å°ç‰ˆæœ¬å·
è·å–å•æ®æ¨¡æ¿ï¼Œä½ è¦è·å–çš„AIç”³è¯·å•
https://docs.ekuaibao.com/docs/open-api/forms/get-specifications-latest
è·å–å½“å‰ç‰ˆæœ¬å•æ®æ¨¡æ¿åˆ—è¡¨
GET
/api/openapi/v1/specifications/latestByType
æ›´æ–°æ—¥å¿—
caution
å•æ®æ¨¡æ¿æœ€åä¸€æ¬¡ä¿®æ”¹ä¿å­˜åçš„ç‰ˆæœ¬ä¸ºå½“å‰ç‰ˆæœ¬ï¼Œæœ€åä¸€æ¬¡ä¿®æ”¹ä¹‹å‰çš„ç‰ˆæœ¬éƒ½ä¸ºå†å²ç‰ˆæœ¬ã€‚
Query Parameters
åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
accessToken	String	è®¤è¯token	å¿…å¡«	-	é€šè¿‡ è·å–æˆæƒ è·å– accessToken
type	String	å•æ®ç±»å‹	å¿…å¡«	-	expense : æŠ¥é”€å•
loan : å€Ÿæ¬¾å•
requisition : ç”³è¯·å•
payment : ä»˜æ¬¾å•
custom : é€šç”¨å®¡æ‰¹å•(åŸºç¡€å•æ®)
specificationGroupId	String	å•æ®æ¨¡æ¿ç»„ID	éå¿…å¡«	-	å•æ®æ¨¡æ¿ç»„ID
curl --location --request GET 'https://app.ekuaibao.com/api/openapi/v1/specifications/latestByType?accessToken=qUMbutefrU8U00&type=expense&specificationGroupId' \
--header 'content-type: application/json' \
--header 'Accept: application/json'

è¿™æ˜¯è·å–å°ç‰ˆæœ¬å·
https://docs.ekuaibao.com/docs/open-api/forms/get-template-byId
æ ¹æ®æ¨¡æ¿IDè·å–æ¨¡æ¿ä¿¡æ¯
GET
/api/openapi/v2/specifications/byIds/[
ids
]
æ›´æ–°æ—¥å¿—
caution
åªè¿”å›æœªåœç”¨ã€æœªåˆ é™¤çš„æ¨¡æ¿ä¿¡æ¯ã€‚
Path Parameters
åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
ids	Array	å•æ®æ¨¡æ¿IDé›†åˆ	å¿…å¡«	-	æ”¯æŒå¤šä¸ªï¼Œæ•°ç»„æ–¹å¼ï¼Œé€šè¿‡ è·å–å½“å‰ç‰ˆæœ¬å•æ®æ¨¡æ¿åˆ—è¡¨ï¼Œ
æ ¹æ®ä¼ä¸šIDè·å–å•æ®æ¨¡æ¿åˆ—è¡¨ è·å–
Query Parameters
åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
accessToken	String	è®¤è¯token	å¿…å¡«	-	é€šè¿‡ è·å–æˆæƒ è·å– accessToken
curl --location --request GET 'https://app.ekuaibao.com/api/openapi/v2/specifications/byIds/[GQgbu2n6osbI00]?accessToken=qUMbutefrU8U00' \
--header 'content-type: application/json' \
--header 'Accept: application/json'
æˆåŠŸå“åº”ï¼Œä»æˆåŠŸé‡Œé¢è¿”å›ç»™AIèŠå¤©ï¼ŒAIèŠå¤©æå–å‡ºå•æ®å­—æ®µï¼Œä»£ç ä¸€ç±»çš„éƒ½ä¸è¦ï¼Œè¦çº¯æ–‡æœ¬
{
    "items": [
        {
            "id": "C20bu2n6osbc00:ebd338960d9053892b3fd86dfa6f31690d014de7", //æ¨¡æ¿ID
            "corporationId": "3Qobu2l0cs6k00",                               //ä¼ä¸šID
            "name": "å·®æ—…æŠ¥é”€å•",                                             //æ¨¡æ¿åç§°
            "state": "PUBLISHED",                                            //å•æ®æ¨¡æ¿çŠ¶æ€ (PUBLISHED:å¯ç”¨ï¼›DRAFT:è‰ç¨¿) 
            "form": [                       //å•æ®æ¨¡æ¿ä¸‹é…ç½®çš„å­—æ®µ
                {
                    "title": {
                        "label": "æ ‡é¢˜",    //å­—æ®µæ˜¾ç¤ºåç§°
                        "type": "text",     //å­—æ®µç±»å‹
                        "optional": false,  //æ˜¯å¦é€‰å¡«
                        "maxLength": 14,    //æœ€å¤§é•¿åº¦
                        "minLength": 0      //æœ€å°é•¿åº¦
                    }
                },
                {
                    "submitterId": {
                        "label": "æäº¤äºº",   //å­—æ®µæ˜¾ç¤ºåç§°
                        "type": "select",   //å­—æ®µç±»å‹
                        "optional": false,  //æ˜¯å¦é€‰å¡«
                        "valueFrom": "organization.Staff" //è¯¥å­—æ®µå–å€¼èŒƒå›´ï¼ˆå–å€¼çš„èŒƒå›´æ˜¯ä»å…¨å±€å­—æ®µä¸­æŸ¥è¯¢çš„ï¼‰
                    }
                },
                {
                    "expenseDate": {
                        "label": "æŠ¥é”€æ—¥æœŸ",
                        "type": "date",
                        "optional": false
                    }
                },
                {
                    "expenseDepartment": {
                        "label": "æŠ¥é”€éƒ¨é—¨",
                        "type": "select",
                        "optional": false,
                        "valueFrom": "organization.Department"
                    }
                },
                {
                    "payeeId": {
                        "label": "æ”¶æ¬¾ä¿¡æ¯",
                        "type": "select",
                        "optional": false,
                        "valueFrom": "pay.PayeeInfo"
                    }
                },
                {
                    "description": {
                        "label": "æè¿°",
                        "type": "text",
                        "optional": true,
                        "maxLength": 140,
                        "minLength": 0
                    }
                },
                {
                    "details": {
                        "label": "è´¹ç”¨æ˜ç»†",
                        "type": "select",
                        "optional": false,
                        "valueFrom": "flow.FeeType"
                    }
                },
                {
                    "expenseLink": {
                        "label": "å…³è”ç”³è¯·",
                        "type": "select",
                        "optional": true,
                        "valueFrom": "requisition.RequisitionInfo"
                    }
                }
            ],
            "visibility": {                 //å¯è§æ€§èŒƒå›´
                "fullVisible": false,
                "staffs": [
                    "xgJ3wajigF25H0:dbc3wajigF1UH0",
                    "xgJ3wajigF25H0:ID01iOBVJdZ93F",
                    "xgJ3wajigF25H0:ID01iOBVJdZiEf",
                    "xgJ3wajigF25H0:eTM3rQTD1y20vw",
                    "xgJ3wajigF25H0:ID_3Dvxff1n3kw"
                ],
                "roles": [],
                "departments": [
                    "xgJ3wajigF25H0"
                ],
                "departmentsIncludeChildren": true
            },
            "flowType": "expense"
        },
        {
            "id": "GQgbu2n6osbI00:55d73bf2a46a1e4d0c9c0e728ab6c36c68484b01",
            "corporationId": "3Qobu2l0cs6k00",
            "name": "æ—¥å¸¸æŠ¥é”€å•",
            "state": "PUBLISHED",
            "form": [
                {
                    "title": {
                        "label": "æ ‡é¢˜",
                        "type": "text",
                        "optional": false,
                        "maxLength": 14,
                        "minLength": 0
                    }
                },
                {
                    "submitterId": {
                        "label": "æäº¤äºº",
                        "type": "select",
                        "optional": false,
                        "valueFrom": "organization.Staff"
                    }
                },
                {
                    "expenseDate": {
                        "label": "æŠ¥é”€æ—¥æœŸ",
                        "type": "date",
                        "optional": false
                    }
                },
                {
                    "expenseDepartment": {
                        "label": "æŠ¥é”€éƒ¨é—¨",
                        "type": "select",
                        "optional": false,
                        "valueFrom": "organization.Department"
                    }
                },
                {
                    "payeeId": {
                        "label": "æ”¶æ¬¾ä¿¡æ¯",
                        "type": "select",
                        "optional": false,
                        "valueFrom": "pay.PayeeInfo"
                    }
                },
                {
                    "description": {
                        "label": "æè¿°",
                        "type": "text",
                        "optional": true,
                        "maxLength": 140,
                        "minLength": 0
                    }
                },
                {
                    "details": {
                        "label": "è´¹ç”¨æ˜ç»†",
                        "type": "select",
                        "optional": false,
                        "valueFrom": "flow.FeeType"
                    }
                },
                {
                    "expenseLink": {
                        "label": "å…³è”ç”³è¯·",
                        "type": "select",
                        "optional": true,
                        "valueFrom": "requisition.RequisitionInfo"
                    }
                }
            ],
            "visibility": {
                "fullVisible": false,
                "staffs": [],
                "roles": [],
                "departments": [
                    "TsI3tt8KjF4S7M"
                ],
                "departmentsIncludeChildren": true
            },
            "flowType": "expense"       //å•æ®æ¨¡æ¿ç±»å‹
        }
    ]
}

2ã€åˆ›å»ºå•æ®+deepseek ç§˜é’¥ï¼Œè¿™é‡Œçš„DEEPseekç§˜é’¥å’ŒèŠå¤©AIä¸ä¸€æ ·ï¼Œä¸ºäº†åŒºåˆ†ï¼Œåˆ›å»ºå•æ®æ—¶ï¼Œdeepseekæ‹¿åˆ°çš„æ˜¯çº¯æ–‡æœ¬ï¼Œæ¯æ¬¡å¯èƒ½ä¸ä¸€æ ·ï¼Œè¦åˆ†æå‡ºæ¥å†…å®¹ç»™MCPï¼Œæ¯ä¸ªå­—æ®µå¯¹åº”çš„jsonæ ¼å¼ï¼ŒMCPå°è£…å‡ºæ¥å£éœ€è¦å†…å®¹ä¼ å€¼
åˆ›å»ºå•æ®æ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯ç”³è¯·å•ï¼Œä¸è€ƒè™‘è´¹ç”¨ç±»å‹è¿™äº›å†…å®¹
åˆ›å»ºå•æ®
æ ¹æ®è·å–çš„å•æ®æ¨¡æ¿å’Œè´¹ç”¨æ¨¡æ¿ï¼ŒæŒ‰æ ¼å¼è¦æ±‚ç»„ç»‡å‚æ•°åï¼Œè°ƒç”¨æ­¤æ¥å£ä¿å­˜å•æ®ä¿¡æ¯ã€‚

POST
/api/openapi/v2.2/flow/data
æ›´æ–°æ—¥å¿—
Query Parameters
åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
accessToken	String	è®¤è¯ token	å¿…å¡«	-	é€šè¿‡ è·å–æˆæƒ è·å– accessToken
isCommit	Boolean	å•æ®æ˜¯å¦ç›´æ¥æå®¡	éå¿…å¡«	false	true : å•æ®ç›´æ¥æå®¡ â€ƒ false : å•æ®ä¿å­˜è‰ç¨¿
isUpdate	Boolean	ç›´æ¥æå®¡å¤±è´¥æ—¶æ˜¯å¦ä¿å­˜å•æ®è‰ç¨¿	éå¿…å¡«	false	isCommit å‚æ•°ä¸º true æ—¶è¯¥å‚æ•°æœ‰æ•ˆ
true : æå®¡å¤±è´¥æ—¶ä¿å­˜è‰ç¨¿
false : æå®¡å¤±è´¥æ—¶ä¸ä¿å­˜è‰ç¨¿
Body Parameters
ä¸åŒè¡¨å•ç±»å‹å‚æ•°å„ä¸ç›¸åŒï¼Œä»¥ä¸‹ä»…ä¸ºç¤ºä¾‹ï¼Œè¯¦è§å•æ®æ¨¡æ¿é…ç½®ï¼š

åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
form	Object	å•æ®ä¿¡æ¯	å¿…å¡«	-	å•æ®ä¿¡æ¯æ•°æ®
â€ƒ âˆŸ outerCode	String	å¤–éƒ¨ç³»ç»Ÿå•æ®ç¼–å·	éå¿…å¡«	-	ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„å•æ®å”¯ä¸€æ ‡è¯†ï¼Œä¸å¯é‡å¤
â€ƒ âˆŸ title	String	å•æ®æ ‡é¢˜	å¿…å¡«	-	å•æ®æ ‡é¢˜
â€ƒ âˆŸ submitterId	String	å•æ®æäº¤äºº ID	å¿…å¡«	-	é€šè¿‡ è·å–å‘˜å·¥åˆ—è¡¨ è·å–
â€ƒ âˆŸ expenseDate	Long	æŠ¥é”€æ—¥æœŸ	éå¿…å¡«	-	æ¯«ç§’çº§æ—¶é—´æˆ³
å‚æ•°ä¸ä¼ æ—¶ï¼Œé»˜è®¤ä¸º å½“å‰æ—¥æœŸ
â€ƒ âˆŸ expenseDepartment	String	æŠ¥é”€éƒ¨é—¨ ID	éå¿…å¡«	-	é€šè¿‡ è·å–éƒ¨é—¨åˆ—è¡¨ è·å–
â€ƒ âˆŸ description	String	æè¿°	éå¿…å¡«	-	æè¿°
â€ƒ âˆŸ payeeId	String	æ”¶æ¬¾è´¦æˆ· ID	å¿…å¡«	-	é€šè¿‡ è·å–æ”¶æ¬¾è´¦æˆ· è·å–
å½“ isCommit = falseï¼ˆä¿å­˜è‰ç¨¿ï¼‰æ—¶ï¼Œå…è®¸éå¿…å¡«
â€ƒ âˆŸ specificationId	String	å•æ®æ¨¡æ¿ ID	å¿…å¡«	-	é€šè¿‡ è·å–å½“å‰ç‰ˆæœ¬å•æ®æ¨¡æ¿åˆ—è¡¨ è·å– å•æ®æ¨¡æ¿ ID
ç„¶åé€šè¿‡ æ ¹æ®æ¨¡æ¿ ID è·å–æ¨¡æ¿ä¿¡æ¯ è·å– åˆ›å»ºå•æ®çš„æ¨¡æ¿ ID
â€ƒ âˆŸ expenseLink	String	å…³è”çš„ç”³è¯·å• ID	éå¿…å¡«	-	ã€æŒ‰ç”³è¯·äº‹é¡¹æ•´ä½“æŠ¥é”€ã€‘æ—¶ä¼ é€’çš„å‚æ•°ï¼Œå…³è”ç”³è¯· æ—¶ 2 é€‰ 1
â€ƒ âˆŸ expenseLinks	Array	å…³è”çš„ç”³è¯·å• ID	éå¿…å¡«	-	ã€æŒ‰ç”³è¯·æ˜ç»†åˆ†åˆ«æŠ¥é”€ã€‘æ—¶ä¼ é€’çš„å‚æ•°ï¼Œå…³è”ç”³è¯· æ—¶ 2 é€‰ 1
â€ƒ âˆŸ linkRequisitionInfo	String	è¡¥å……ç”³è¯·	éå¿…å¡«	-	ç”³è¯·å• è¡¥å……ç”³è¯· æ—¶ä½¿ç”¨ï¼Œå€¼ä¸ºéœ€è¦è¡¥å……çš„ç”³è¯·å• ID
â€ƒ âˆŸ details	Array	è´¹ç”¨æ˜ç»†	å¿…å¡«	-	è´¹ç”¨æ˜ç»†
â€ƒ â€ƒ âˆŸ feeTypeId	String	è´¹ç”¨ç±»å‹ ID	å¿…å¡«	-	é€šè¿‡ è·å–è´¹ç”¨ç±»å‹åˆ—è¡¨(åŒ…å«åœç”¨) è·å–
â€ƒ â€ƒ âˆŸ specificationId	String	è´¹ç”¨ç±»å‹æ¨¡æ¿ ID	å¿…å¡«	-	é€šè¿‡ æ ¹æ® ID æˆ– CODE è·å–è´¹ç”¨ç±»å‹æ¨¡æ¿ä¿¡æ¯ è·å–
â€ƒ â€ƒ âˆŸ feeTypeForm	Object	è´¹ç”¨ä¿¡æ¯	å¿…å¡«	-	è´¹ç”¨ä¿¡æ¯ï¼Œå…·ä½“ä¼ å‚è¯·è§è·å–è´¹ç”¨æ¨¡æ¿æ¥å£è¿”å›å€¼
â€ƒ â€ƒ â€ƒ âˆŸ amount	Object	æŠ¥é”€é‡‘é¢	å¿…å¡«	-	æŠ¥é”€é‡‘é¢
â€ƒ â€ƒ â€ƒ âˆŸ feeDate	Long	è´¹ç”¨æ—¥æœŸ	å¿…å¡«	-	æ¯«ç§’çº§æ—¶é—´æˆ³
â€ƒ â€ƒ â€ƒ âˆŸ feeDetailPayeeId	String	æ”¶æ¬¾ä¿¡æ¯ ID	éå¿…å¡«	-	å¤šæ”¶æ¬¾äººæ¨¡å¼ä¸‹ï¼ŒæŒ‰æ˜ç»†/æŒ‰æ”¶æ¬¾ä¿¡æ¯æ±‡æ€»æ˜ç»†é‡‘é¢ ç±»å‹æ—¶ å¿…å¡«
é€šè¿‡ è·å–æ”¶æ¬¾è´¦æˆ· è·å–
â€ƒ â€ƒ â€ƒ âˆŸ invoiceForm	Object	å‘ç¥¨ç›¸å…³ä¿¡æ¯	éå¿…å¡«	-	å‘ç¥¨å‚æ•°
â€ƒ â€ƒ â€ƒ â€ƒ âˆŸ type	String	å‘ç¥¨å¼€ç¥¨ç±»å‹	éå¿…å¡«	-	unify : ç»Ÿä¸€å¼€ç¥¨ â€ƒ wait : å¾…å¼€å‘ç¥¨
exist : å·²æœ‰å‘ç¥¨ â€ƒ noExist : æ— å‘ç¥¨
noWrite : æ— éœ€å¡«å†™(å½“è´¹ç”¨ç±»å‹å‘ç¥¨å­—æ®µè®¾ç½®çš„ä¸å¯ç¼–è¾‘æ—¶ï¼Œé»˜è®¤ä¸ºæ­¤é¡¹)
â€ƒ â€ƒ â€ƒ â€ƒ âˆŸ invoices	Array	å‘ç¥¨ä¿¡æ¯	éå¿…å¡«	-	é€šè¿‡ æ™ºèƒ½æ‹ç¥¨ ã€ç”µå­å‘ç¥¨æ–‡ä»¶(PCç«¯) ã€æ‰‹å·¥å½•å…¥ ã€å¾®ä¿¡å‘ç¥¨ ã€åŒ»ç–—å‘ç¥¨ ã€æ‰«æå‘ç¥¨(ç§»åŠ¨ç«¯) ã€çˆ±å‘ç¥¨ ã€æ”¯ä»˜å®å¡åŒ… ç­‰æ–¹å¼æŸ¥éªŒå‘ç¥¨åï¼Œå°†å‘ç¥¨ä¿¡æ¯ç»‘å®šåˆ°æ­¤å‚æ•°ä¸­ï¼Œä¼ å‚æ ¼å¼è§ å‘ç¥¨å­—æ®µå¡«å†™è§„åˆ™
â€ƒ â€ƒ â€ƒ â€ƒ âˆŸ attachments	Array	å‘ç¥¨é™„ä»¶	éå¿…å¡«	-	é€šè¿‡ å‘ç¥¨ç…§ç‰‡ æ–¹å¼å¯¼å…¥æ—¶ï¼Œå‘ç¥¨ä¿¡æ¯ç»‘å®šæ­¤å‚æ•°ï¼Œä¼ å‚æ ¼å¼è§ å‘ç¥¨å­—æ®µå¡«å†™è§„åˆ™
ä»…æ”¯æŒç»‘å®šå›¾ç‰‡ç±»å‹çš„é™„ä»¶ï¼Œå¹¶ä¸”è¯¥æ–¹å¼æ— æ³•å¯¹å‘ç¥¨é™„ä»¶è¿›è¡Œ OCR å¤„ç†ä»¥åŠéªŒçœŸæŸ¥é‡
â€ƒ â€ƒ â€ƒ âˆŸ consumptionReasons	String	æ¶ˆè´¹äº‹ç”±	éå¿…å¡«	-	æ¶ˆè´¹äº‹ç”±
â€ƒ â€ƒ â€ƒ âˆŸ apportions	Array	åˆ†æ‘Šæ˜ç»†	éå¿…å¡«	-	æ ¹æ®å•æ®æ¨¡æ¿å†³å®š
â€ƒ â€ƒ â€ƒ â€ƒ âˆŸ apportionForm	Object	åˆ†æ‘Šæ˜ç»†å…·ä½“ä¿¡æ¯	éå¿…å¡«	-	åˆ†æ‘Šæ˜ç»†å…·ä½“ä¿¡æ¯
params	Object	å•æ®å…¶ä»–ä¿¡æ¯	éå¿…å¡«	-	å•æ®å…¶ä»–ä¿¡æ¯æ•°æ®
â€ƒ âˆŸ loanWrittenOff	Array	æ ¸é”€å€Ÿæ¬¾ä¿¡æ¯	éå¿…å¡«	-	è¯¦ç»†å‚æ•°è§ä¸‹æ–¹ç¤ºä¾‹
å…¨é‡æ›´æ–°æ—¶è¯¥å‚æ•°å¿…å¡«ï¼Œå¦åˆ™åŸæ•°æ®ä¼šè¢«æ¸…ç©º
tip
ä¸ç³»ç»Ÿä¸Šçš„ä¿å­˜å•æ®åŠŸèƒ½ä¸€æ ·ï¼ŒæŒ‰æ ¼å¼ç»„ç»‡æ•°æ®ï¼Œä¿å­˜å•æ®ä¿¡æ¯ï¼Œä¿å­˜æˆåŠŸåï¼Œä¼šè¿”å›è¯¥å•æ®å®ä¾‹ä¿¡æ¯ã€‚
ç¨‹åºä¼šæ ¡éªŒè¯·æ±‚å‚æ•°åŠ body æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼š
ä¼ å‚ æ”¯æŒè®¡ç®—å…¬å¼è‡ªåŠ¨è®¡ç®—ï¼Œå¦‚æœæŸä¸ªå­—æ®µå‚æ•°å¯ä»¥æ ¹æ®é…ç½®çš„è®¡ç®—å…¬å¼åœ¨ç°æœ‰ä¼ å‚åŸºç¡€ä¸Šè®¡ç®—å‡ºç»“æœï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥ ä¸ä¼ å€¼ï¼›
ä¼ å‚ æ”¯æŒæ±‚å’Œå…¬å¼è‡ªåŠ¨è®¡ç®—ï¼Œå¦‚æœæŸä¸ªé‡‘é¢å­—æ®µå‚æ•°å¯ä»¥æ ¹æ®é…ç½®çš„æ±‚å’Œå…¬å¼åœ¨ç°æœ‰é‡‘é¢å‚æ•°ä¸Šè®¡ç®—å‡ºç»“æœï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥ ä¸ä¼ å€¼ï¼›
ä¼ å‚ æ”¯æŒæ¡£æ¡ˆå…³ç³»å…³è”å‚æ•°ï¼Œå¦‚æœæŸä¸ªå­—æ®µå‚æ•°å¯ä»¥æ ¹æ®é…ç½®çš„æ¡£æ¡ˆå…³ç³»åœ¨ç°æœ‰ä¼ å‚åŸºç¡€ä¸ŠæŸ¥è¯¢å‡ºå…³è”ç»“æœï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥ ä¸ä¼ å€¼ï¼›
ä¼ å‚ æ”¯æŒä¸šåŠ¡å¯¹è±¡è”åŠ¨èµ‹å€¼ï¼Œå¦‚æœæŸä¸ªå­—æ®µå‚æ•°å¯ä»¥è¢«é…ç½®çš„ä¸šåŠ¡å¯¹è±¡èµ‹å€¼è§„åˆ™èµ‹å€¼ï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥ ä¸ä¼ å€¼ï¼›
æŠ¥é”€å•ä¼ å‚ æ”¯æŒä»å…³è”çš„ç”³è¯·å•è‡ªåŠ¨èµ‹å€¼ï¼Œå¦‚æœæŸä¸ªå­—æ®µå‚æ•°é…ç½®æ ¹æ®å…³è”ç”³è¯·å•å–å€¼ï¼Œé‚£ä¹ˆè¯¥å­—æ®µå¯ä»¥ ä¸ä¼ å€¼ã€‚
åœ¨ å…è®¸å…³è”å¤šä¸ªç”³è¯·äº‹é¡¹ é…ç½®ä¸‹ï¼Œè‡ªåŠ¨èµ‹å€¼ä¸ç”Ÿæ•ˆã€‚
CURL å®ä¾‹æ˜¯ç”¨æŠ¥é”€å•å¡«å†™ï¼Œæˆ‘ä»¬æ˜¯ç”³è¯·å•ï¼Œä¸ç”¨è€ƒè™‘è´¹ç”¨æ˜ç»†ï¼Œåªè€ƒè™‘è¡¨ä½“å†…å®¹
curl --location --request POST 'https://app.ekuaibao.com/api/openapi/v2.2/flow/data?accessToken=ID_3tLWHTx0B8g:PCx3rwm3aA00qM' \
--header 'Content-Type: application/json' \
--data-raw '{
    "form":{
        "outerCode":"WB-10001",                       //å¤–éƒ¨ç³»ç»Ÿå•æ®ç¼–å·
        "title":"æµ‹è¯•æ—¥å¸¸æŠ¥é”€å•4",                     //å•æ®æ ‡é¢˜
        "details":[                                   //è´¹ç”¨æ˜ç»†
            {
                "feeTypeId":"PCx3rwm3aA00qM:hotel",   //è´¹ç”¨ç±»å‹ID
                "feeTypeForm":{                       //è´¹ç”¨ä¿¡æ¯
                    "amount":{                        //æŠ¥é”€é‡‘é¢
                        "standard":"335",
                        "standardUnit":"å…ƒ",
                        "standardScale":2,
                        "standardSymbol":"Â¥",
                        "standardNumCode":"156",
                        "standardStrCode":"CNY"
                    },
                    "apportions":[                    //åˆ†æ‘Šæ˜ç»†å…·ä½“ä¿¡æ¯
                        {
                            "apportionForm":{
                                "é¡¹ç›®":"ID_3rw$2RXfelM",          //é¡¹ç›®
                                "apportionId":"ID_3tLTuqz9b6M",  //åˆ†æ‘Šæ˜ç»†ID
                                "apportionMoney":{               //åˆ†æ‘Šé‡‘é¢
                                    "standard":"335",
                                    "standardUnit":"å…ƒ",
                                    "standardScale":2,
                                    "standardSymbol":"Â¥",
                                    "standardNumCode":"156",
                                    "standardStrCode":"CNY"
                                },
                                "apportionPercent":"100.00",                         //åˆ†æ‘Šç™¾åˆ†æ¯”
                                "expenseDepartment":"PCx3rwm3aA00qM:ID_3rw$2RXc5lM"  //åˆ†æ‘Šéƒ¨é—¨
                            },
                            "specificationId":"PCx3rwm3aA00qM:æŠ¥é”€éƒ¨é—¨&é¡¹ç›®åˆ†æ‘Š:0234d1a99e67306c72df937ba8d4f7abb60e2c20"   //åˆ†æ‘Šæ–¹å¼ID
                        }
                    ],
                    "invoiceForm":{          //å‘ç¥¨é™„ä»¶
                        "type":"exist",      //å·²æœ‰å‘ç¥¨
                        "attachments":[      //å¦‚æœæ²¡æœ‰é™„ä»¶,ä¸ä¼ æ­¤å­—æ®µ(é™„ä»¶å…ˆé€šè¿‡â€œä¸Šä¼ é™„ä»¶â€æ¥å£ä¸Šä¼ æ•°æ®)
                            {
                                "key":"OffLine-1639378118926-931.jpg",
                                "fileId":"ID_3tLTuqz8f6M",
                                "fileName":"OffLine.jpg"
                            }
                        ]
                    },
                    "feeDatePeriod":{        //è‡ªå®šä¹‰é…ç½®çš„æ—¥æœŸèŒƒå›´å­—æ®µ
                        "end":1639324800000,
                        "start":1639324800000
                    },
                    "consumptionReasons":"123"  //æ¶ˆè´¹äº‹ç”±
                },
                "specificationId":"PCx3rwm3aA00qM:hotel:expense:f9c75771191e4003f850fd9bf07eedd977459cc2"   //è´¹ç”¨ç±»å‹æ¨¡æ¿ID
            }
        ],
        "payeeId":"ID_3s4PKc13U$g", //æ”¶æ¬¾è´¦æˆ·ID
        "u_Zå‘˜å·¥":"PCx3rwm3aA00qM:SUv3rzY$rz02t0",
        "u_ZåŸå¸‚":"[{\"key\":\"2123\",\"label\":\"å¹¿ä¸œçœ/å¹¿å·å¸‚/å¹¿å·å¸‚åŒº\"}]",
        "u_Zå°æ•°":"345.354",
        "u_Zå¼€å…³":true,
        "u_Zæ•´æ•°":"3323",
        "u_Zæ–‡æœ¬":"æµ‹è¯•2",
        "u_Zæ—¥æœŸ":1639324800000,
        "u_Zæ¡£æ¡ˆ":"ID_3tLfV301eDw",
        "u_Zéƒ¨é—¨":"PCx3rwm3aA00qM",
        "u_Zé™„ä»¶":[
            {
                "key":"s-search-1639378172493-850.png",
                "fileId":"ID_3tLTuqz8w6M",
                "fileName":"s-search.png"
            }
        ],
        "description":"123",            //æè¿°
        "expenseDate":1639324800000,    //æŠ¥é”€æ—¥æœŸ
        "expenseLink":"ID_3twRddlb0$w", //å…³è”çš„ç”³è¯·å•IDï¼ˆã€æŒ‰ç”³è¯·äº‹é¡¹æ•´ä½“æŠ¥é”€ã€‘æ—¶ä¼ é€’çš„å‚æ•°ï¼‰ï¼Œå¦‚å•æ®æ— éœ€å…³è”ç”³è¯·å•ï¼Œå¯ä¸åœ¨formå¯¹è±¡ä¸­æ·»åŠ è¯¥å­—æ®µ
        "submitterId":"PCx3rwm3aA00qM:VWf3rvZHCb0ghM",  //æäº¤äººID
        "specificationId":"ID_3rwlFm523WM:2f01211a2447e29378d078e1219a51899eff7d36",    //å•æ®æ¨¡æ¿ID
        "u_Zä¸šåŠ¡å¯¹è±¡":"ID_3tLfV302QDw",
        "u_Zæšä¸¾å‘ç¥¨":"MotorInvoice",
        "u_Zæšä¸¾ç«è½¦":"SW",
        "u_Zæšä¸¾èˆªç­":"BUSINESS",
        "u_Zæšä¸¾è½®èˆ¹":"ER",
        "u_Zæ¡£æ¡ˆå¤šé€‰":[
            "ad0dbcd46cf6d0104c00",
            "dc0dbcd46cf6d0184c00",
            "dc0dbcd46cf6d01c4c00"
        ],
        "u_Zä¸šåŠ¡å¯¹è±¡2":[
            {
                "dataLinkId":null,
                "dataLinkForm":{
                    "E_cb0dbe8855a794ff5800_code":"ZGY003",
                    "E_cb0dbe8855a794ff5800_name":"ZGYè‡ªå®šä¹‰3",
                    "E_cb0dbe8855a794ff5800_æ‰€åœ¨éƒ¨é—¨":"PCx3rwm3aA00qM"
                },
                "dataLinkTemplateId":"ID_3rW8lqul4Rw"     //ä¸šåŠ¡å¯¹è±¡æ¨¡æ¿ID
            }
        ],
        "expenseDepartment":"PCx3rwm3aA00qM"   //æŠ¥é”€éƒ¨é—¨
    },
     "params":{                                //å½“éœ€è¦æ·»åŠ æ ¸é”€å€Ÿæ¬¾æ—¶æ·»åŠ è¯¥å‚æ•°
        "loanWrittenOff":[                     //è¡¨ç¤ºæŠ¥é”€å•ä¸­çš„æ ¸é”€å€Ÿæ¬¾å­—æ®µ
            {
              "loanInfoId":"ID_3sJUjsRJUrw",   //å€Ÿæ¬¾åŒ…IDï¼Œå¿…å¡«
              "title":"æµ‹è¯•",                  //å€Ÿæ¬¾å•æ ‡é¢˜ï¼Œå¿…å¡«
              "repaymentDate":1641724500000,   //è¿˜æ¬¾æ—¥æœŸï¼Œå¿…å¡«
              "fromApply":false,               //å¿…å¡«
              "flowId":"ID_3seTcgi0qrg",       //å€Ÿæ¬¾å•IDï¼Œå¿…å¡«
              "hasImported":false,             //å¿…å¡«
              "amount":"222"                   //æ ¸é”€é‡‘é¢ï¼Œå¿…å¡«
            }
        ]
    }
}'

æˆåŠŸå“åº”
{
  "value": "",
  "type": -1,
  "flow": {
    "pipeline": 1,
    "grayver": "9.8.0.0:A",
    "version": 1,
    "active": true,
    "createTime": 1639392015626,
    "updateTime": 1639392015626,
    "corporationId": "PCx3rwm3aA00qM",
    "sourceCorporationId": null,
    "dataCorporationId": null,
    "form": {
      "outerCode": "WB-10001",
      "title": "æµ‹è¯•æ—¥å¸¸æŠ¥é”€å•5",
      "details": [
        {
          "feeTypeId": "PCx3rwm3aA00qM:hotel",
          "feeTypeForm": {
            "amount": {
              "standard": "335",
              "standardUnit": "å…ƒ",
              "standardScale": 2,
              "standardSymbol": "Â¥",
              "standardNumCode": "156",
              "standardStrCode": "CNY"
            },
            "detailId": "txL8K9Xdy1QxLo",
            "apportions": [
              {
                "apportionForm": {
                  "é¡¹ç›®": "ID_3rw$2RXfelM",
                  "apportionId": "ID_3tLTuqz9b6M",
                  "apportionMoney": {
                    "standard": "335",
                    "standardUnit": "å…ƒ",
                    "standardScale": 2,
                    "standardSymbol": "Â¥",
                    "standardNumCode": "156",
                    "standardStrCode": "CNY"
                  },
                  "apportionPercent": "100.00",
                  "expenseDepartment": "PCx3rwm3aA00qM:ID_3rw$2RXc5lM"
                },
                "specificationId": "PCx3rwm3aA00qM:æŠ¥é”€éƒ¨é—¨&é¡¹ç›®åˆ†æ‘Š:0234d1a99e67306c72df937ba8d4f7abb60e2c20"
              }
            ],
            "invoiceForm": {
              "type": "exist",
              "attachments": [
                {
                  "key": "OffLine-1639378118926-931.jpg",
                  "fileId": "ID_3tLTuqz8f6M",
                  "fileName": "OffLine.jpg"
                }
              ]
            },
            "feeDatePeriod": {
              "end": 1639324800000,
              "start": 1639324800000
            },
            "consumptionReasons": "123"
          },
          "specificationId": "PCx3rwm3aA00qM:hotel:expense:f9c75771191e4003f850fd9bf07eedd977459cc2"
        }
      ],
      "payeeId": "ID_3s4PKc13U$g",
      "payMoney": {
        "standard": "113.00",
        "standardUnit": "å…ƒ",
        "standardScale": 2,
        "standardSymbol": "Â¥",
        "standardNumCode": "156",
        "standardStrCode": "CNY"
      },
      "u_Zå‘˜å·¥": "PCx3rwm3aA00qM:SUv3rzY$rz02t0",
      "u_ZåŸå¸‚": "[{\"key\":\"2123\",\"label\":\"å¹¿ä¸œçœ/å¹¿å·å¸‚/å¹¿å·å¸‚åŒº\"}]",
      "u_Zå°æ•°": "345.354",
      "u_Zå¼€å…³": true,
      "u_Zæ•´æ•°": "3323",
      "u_Zæ–‡æœ¬": "æµ‹è¯•2",
      "u_Zæ—¥æœŸ": 1639324800000,
      "u_Zæ¡£æ¡ˆ": "ID_3tLfV301eDw",
      "u_Zéƒ¨é—¨": "PCx3rwm3aA00qM",
      "u_Zé™„ä»¶": [
        {
          "key": "s-search-1639378172493-850.png",
          "fileId": "ID_3tLTuqz8w6M",
          "fileName": "s-search.png"
        }
      ],
      "voucherNo": "",
      "printCount": "0",
      "printState": "noPrint",
      "submitDate": 1639392015024,
      "description": "123",
      "expenseDate": 1639324800000,
      "expenseLink": "ID_3twRddlb0$w",
      "submitterId": "PCx3rwm3aA00qM:VWf3rvZHCb0ghM",
      "specificationId": "ID_3rwlFm523WM:2f01211a2447e29378d078e1219a51899eff7d36",
      "u_Zä¸šåŠ¡å¯¹è±¡": "ID_3tLfV302QDw",
      "u_Zæšä¸¾å‘ç¥¨": "MotorInvoice",
      "u_Zæšä¸¾ç«è½¦": "SW",
      "u_Zæšä¸¾èˆªç­": "BUSINESS",
      "u_Zæšä¸¾è½®èˆ¹": "ER",
      "u_Zæ¡£æ¡ˆå¤šé€‰": [
        "ad0dbcd46cf6d0104c00",
        "dc0dbcd46cf6d0184c00",
        "dc0dbcd46cf6d01c4c00"
      ],
      "u_Zä¸šåŠ¡å¯¹è±¡2": [
        {
          "dataLinkId": null,
          "dataLinkForm": {
            "E_cb0dbe8855a794ff5800_code": "ZGY003",
            "E_cb0dbe8855a794ff5800_name": "ZGYè‡ªå®šä¹‰3",
            "E_cb0dbe8855a794ff5800_æ‰€åœ¨éƒ¨é—¨": "PCx3rwm3aA00qM"
          },
          "dataLinkTemplateId": "ID_3rW8lqul4Rw"
        }
      ],
      "expenseDepartment": "PCx3rwm3aA00qM",
      "voucherCreateTime": 0,
      "u_æ€»ä»·": {
        "standard": "0.00",
        "standardStrCode": "CNY",
        "standardNumCode": "156",
        "standardSymbol": "Â¥",
        "standardUnit": "å…ƒ",
        "standardScale": "2"
      },
      "quantity": "0",
      "writtenOffMoney": {
        "standard": "222.00",
        "standardUnit": "å…ƒ",
        "standardScale": 2,
        "standardSymbol": "Â¥",
        "standardNumCode": "156",
        "standardStrCode": "CNY"
      },
      "companyRealPay": {
        "standard": "0.00",
        "standardUnit": "å…ƒ",
        "standardScale": 2,
        "standardSymbol": "Â¥",
        "standardNumCode": "156",
        "standardStrCode": "CNY"
      },
      "voucherStatus": "æœªç”Ÿæˆ",
      "expenseMoney": {
        "standard": "335.00",
        "standardUnit": "å…ƒ",
        "standardScale": 2,
        "standardSymbol": "Â¥",
        "standardNumCode": "156",
        "standardStrCode": "CNY"
      },
      "code": "B21000008"
    },
    "ownerId": "PCx3rwm3aA00qM:VWf3rvZHCb0ghM",
    "ownerDefaultDepartment": "PCx3rwm3aA00qM",
    "state": "draft",
    "flowType": "freeflow",
    "formType": "expense",
    "logs": [],
    "actions": {
      "PCx3rwm3aA00qM:VWf3rvZHCb0ghM": [
        "freeflow.delete",
        "freeflow.edit",
        "freeflow.submit"
      ]
    },
    "invoiceRemind": false,
    "id": "ID_3tMDtL05ClM" //å•æ®ID
  }
}

3ã€è·å–å•æ®é€šè¿‡å•æ®IDè·å–å•æ®ä¿¡æ¯
https://docs.ekuaibao.com/docs/open-api/flows/get-forms-details
æ ¹æ®å•æ®IDè·å–å•æ®è¯¦æƒ…
GET
/api/openapi/v1.1/flowDetails
æ›´æ–°æ—¥å¿—
caution
å•æ®çŠ¶æ€ä¸º å·²åˆ é™¤ çš„å•æ®æ— æ³•è¢«æŸ¥è¯¢åˆ°ï¼Œå¹¶æŠ¥é”™â€œå•æ®å·²åˆ é™¤â€ã€‚
Query Parameters
åç§°	ç±»å‹	æè¿°	æ˜¯å¦å¿…å¡«	é»˜è®¤å€¼	å¤‡æ³¨
accessToken	String	è®¤è¯token	å¿…å¡«	-	é€šè¿‡ è·å–æˆæƒ è·å– accessToken
flowId	String	å•æ®ID	å¿…å¡«	-	å•æ®IDè·å–æ–¹å¼
tip
å•æ®ç¼–å·æ˜¯é¢å‘ä¼ä¸šå”¯ä¸€ï¼Œå•æ®IDæ˜¯é¢å‘ç³»ç»Ÿå”¯ä¸€ã€‚
CURL
curl --location --request GET 'https://app.ekuaibao.com/api/openapi/v1.1/flowDetails?flowId=8ZAbsRr6_QfA00&accessToken=TNQbsyYQV80I00'
æˆåŠŸå“åº”
{
    "value": {
        "pipeline": 1,
        "grayver": "9.7.0.0:A",
        "version": 1,   
        "active": true, 
        "createTime": 1638296463891,    
        "updateTime": 1638296463889,
        "corporationId": "djg8LshfUkfM00",
        "sourceCorporationId": null,
        "dataCorporationId": null,
        "form": {
            "code": "J20000002",
            "title": "test",
            "loanDate": 1600095120000,
            "payMoney": {   //æ”¯ä»˜é‡‘é¢
                "standard": "100.00",
                "standardUnit": "å…ƒ",
                "standardScale": 2,
                "standardSymbol": "Â¥",
                "standardNumCode": "156",
                "standardStrCode": "CNY"
            },
            "loanMoney": {  //å€Ÿæ¬¾é‡‘é¢
                "standard": "100.00",
                "standardUnit": "å…ƒ",
                "standardScale": 2,
                "standardSymbol": "Â¥",
                "standardNumCode": "156",
                "standardStrCode": "CNY"
            },
            "voucherNo": "",    //å‡­è¯å·
            "printCount": "0",  //æ‰“å°æ•°
            "printState": "noPrint",    //æ‰“å°çŠ¶æ€
            "submitDate": 1638296419034,
            "attachments": [],
            "description": "",
            "submitterId": "djg8LshfUkfM00:fuwb0AND7Mio00",
            "repaymentDate": 9007199254740991,  //è¿˜æ¬¾æ—¥
            "voucherStatus": "æœªç”Ÿæˆ",           //å‡­è¯çŠ¶æ€
            "loanDepartment": "djg8LshfUkfM00:LcEb0AGaYs1000",  //å€Ÿæ¬¾éƒ¨é—¨
            "specificationId": "Zp4bxmeHjAj400:02e4cad692c302a4600916a52283d5cc294d9b80",  //è´¹ç”¨ç±»å‹æ¨¡æ¿ID
            "voucherCreateTime": 0,             //å‡­è¯ç”Ÿæˆæ—¶é—´
            "preNodeApprovedTime": 1638296463889
        },
        "ownerId": "djg8LshfUkfM00:fuwb0AND7Mio00",
        "ownerDefaultDepartment": "djg8LshfUkfM00:LcEb0AGaYs1000",
        "state": "rejected",
        "flowType": "freeflow",
        "formType": "loan",
        "logs": [     //å®¡æ‰¹è®°å½•
            {
                "action": "freeflow.submit",
                "state": "approving",
                "operatorId": "djg8LshfUkfM00:fuwb0AND7Mio00",
                "byDelegateId": null,
                "operatorDefaultDepartment": "djg8LshfUkfM00:LcEb0AGaYs1000",
                "nextOperatorId": "ebot",
                "nextOperatorIds": [],
                "time": 1600095160535,
                "attributes": {   //åŠ¨ä½œç›¸å…³å±æ€§
                    "nextId": "FLOW:1613728245:1657041998",
                    "nodeId": "SUBMIT",
                    "comment": "",
                    "isUrgent": false,
                    "nextName": "è´¹ç”¨æ ‡å‡†æ£€æŸ¥",
                    "urgentReason": "",
                    "resubmitMethod": "FROM_START",
                    "nextCounterSign": false,
                    "sensitiveContent": null,
                    "resubmitOperatorIds": []
                },
                "modifyFlowLog": [   //ä¿®æ”¹è®°å½•
                    {
                        "version": 1,
                        "flowVersionedId": "rC8bAFRme04800",
                        "operatorId": "djg8LshfUkfM00:fuwb0AND7Mio00",
                        "operatorTime": 1600095160535,
                        "operatorState": "CREATE",
                        "editeReason": "",
                        "byDelegateId": null
                    }
                ],
                "attachments": []
            },
            {
                "action": "freeflow.reject",
                "state": "rejected",
                "operatorId": "djg8LshfUkfM00:fuwb0AND7Mio00",
                "byDelegateId": null,
                "operatorDefaultDepartment": "djg8LshfUkfM00:LcEb0AGaYs1000",
                "nextOperatorId": "djg8LshfUkfM00:fuwb0AND7Mio00",
                "nextOperatorIds": [],
                "time": 1600095178396,
                "attributes": {
                    "isAuto": false,
                    "nextId": null,
                    "nodeId": "FLOW:394776106:2040792856",
                    "comment": "test",
                    "isEbotNode": false,
                    "isStaffExit": false,
                    "resubmitMethod": "FROM_START",
                    "isCostControlCheck": false
                },
                "modifyFlowLog": null,
                "attachments": []
            }
        ],
        "actions": {    //æ“ä½œäººå¯æ‰§è¡Œåˆ°åŠ¨ä½œ  `key`æ˜¯æ“ä½œäººçš„å‘˜å·¥IDï¼›`value`æ˜¯åŠ¨ä½œåç§°
            "djg8LshfUkfM00:fuwb0AND7Mio00": [
                "freeflow.delete",
                "freeflow.edit",
                "freeflow.submit"
            ]
        },
        "invoiceRemind": false,
        "id": "-UkbAFQSiIk000"
    }
}